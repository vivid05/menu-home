var H=Object.defineProperty;var K=(t,i,s)=>i in t?H(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s;var M=(t,i,s)=>K(t,typeof i!="symbol"?i+"":i,s);import{r as f,j as e,a as Q}from"./react-BwYbncKq.js";import{c as U}from"./react-dom-CYoFxZK3.js";import{T,S as R,s as d,C as A,B as g,F as _,a as F,M as G,b as I,I as X,D as S,c as Z,z as ee}from"./antd-DQNjyfAT.js";import{D as te}from"./dexie-CHToNQ8G.js";import{u as D,a as P,B as re,R as se,b as J}from"./react-router-DIMhQKeV.js";import{t as ne,P as $,Q as Y,T as oe,U as W,V as ie}from"./@ant-design-BDIhShda.js";import{F as q}from"./@monaco-editor-BdY340vY.js";import"./@babel-C_SyoEfJ.js";import"./scheduler-DYLXRpC5.js";import"./rc-util-qpEr0zEL.js";import"./react-is-DcAOwtUU.js";import"./classnames-C6I1OsXt.js";import"./rc-resize-observer-Djs7foYh.js";import"./resize-observer-polyfill-B1PUzC5B.js";import"./rc-motion-fdt2-AWL.js";import"./@rc-component-BhmwWRgm.js";import"./rc-overflow-BSjmwJ5L.js";import"./rc-tabs-DzBt95t3.js";import"./rc-dropdown-Cpbpbr8d.js";import"./rc-menu-odk1-mql.js";import"./rc-select-BYP2ZpD4.js";import"./rc-virtual-list-Bi_WoJXF.js";import"./rc-field-form-W94e64e7.js";import"./rc-dialog-BcW66EVf.js";import"./rc-notification-Bk_9v6gO.js";import"./rc-table-DDN2Jo9n.js";import"./rc-tree-BGBWsLK6.js";import"./rc-checkbox-gkqbq-se.js";import"./scroll-into-view-if-needed-Bq0bK-M8.js";import"./compute-scroll-into-view-Bl8rNFhg.js";import"./rc-pagination-Bvz_Ru-I.js";import"./throttle-debounce-CUWDS_la.js";import"./rc-input-DdsdxYUa.js";import"./rc-picker-ctJ4hI_D.js";import"./rc-tooltip-aJh4r6ka.js";import"./rc-textarea-7R1xcK0F.js";import"./copy-to-clipboard-DhLP-jDv.js";import"./toggle-selection-BHUZwh74.js";import"./@emotion-CW87jbl0.js";import"./stylis-D5iaQeiq.js";import"./state-local-BBNhjlcY.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const m of c.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&n(m)}).observe(document,{childList:!0,subtree:!0});function s(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerPolicy&&(c.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?c.credentials="include":a.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(a){if(a.ep)return;a.ep=!0;const c=s(a);fetch(a.href,c)}})();class ae extends te{constructor(){super("MenuDatabase");M(this,"menuConfigs");this.version(1).stores({menuConfigs:"++id, version, name, createdAt, updatedAt"})}}const b=new ae,j={async getAll(){return b.menuConfigs.orderBy("createdAt").reverse().toArray()},async getById(t){return b.menuConfigs.get(Number(t))},async searchByVersion(t){return b.menuConfigs.where("version").startsWithIgnoreCase(t).reverse().sortBy("createdAt")},async add(t){const i=new Date;return b.menuConfigs.add({...t,createdAt:i,updatedAt:i})},async update(t,i){await b.menuConfigs.update(Number(t),{...i,updatedAt:new Date})},async delete(t){await b.menuConfigs.delete(Number(t))},async deleteByVersion(t){const s=(await this.searchByVersion(t)).map(n=>n.id);await b.menuConfigs.bulkDelete(s)},async exportAll(){return this.getAll()},async importConfigs(t){await b.menuConfigs.bulkAdd(t.map(i=>({...i,id:void 0})))}},{confirm:le}=G,{Title:ce}=T,{Option:de}=R,ue=()=>{const t=[{value:"",label:"全部版本"}],i=2025;for(let s=1;s<=12;s++)for(let n=1;n<=2;n++){const a=`${i}-${s}月${n}期`,c=`${i}年${s}月${n}期`;t.push({value:a,label:c})}return t},pe=()=>{const[t,i]=f.useState([]),[s,n]=f.useState([]),[a,c]=f.useState(!1),[m,C]=f.useState(""),w=D(),x=()=>{const r=new Date,p=r.getFullYear(),o=r.getMonth()+1;return`${p}-${o}月1期`};f.useEffect(()=>{u()},[]),f.useEffect(()=>{const r=x();C(r),h(r)},[]);const u=async()=>{c(!0);try{const r=await j.getAll();i(r),n(r)}catch{d.error("加载菜单配置失败")}finally{c(!1)}},h=async r=>{if(C(r),!r){n(t);return}try{const p=await j.searchByVersion(r);n(p)}catch{d.error("筛选失败")}},B=async r=>{try{await navigator.clipboard.writeText(r),d.success("JSON配置已复制到剪贴板")}catch{const o=document.createElement("textarea");o.value=r,document.body.appendChild(o),o.select(),document.execCommand("copy"),document.body.removeChild(o),d.success("JSON配置已复制到剪贴板")}},L=async()=>{if(!m){d.warning("请先选择一个迭代版本");return}try{const r=s.length>0?s:await j.searchByVersion(m),p=[];for(const l of r)try{const v=JSON.parse(l.jsonConfig),z=(y,V=l.path)=>{Array.isArray(y)?y.forEach(O=>z(O,V)):typeof y=="object"&&y!==null&&(y.name&&p.push(`${V}//${y.name}`),Object.keys(y).forEach(O=>{typeof y[O]=="object"&&y[O]!==null&&z(y[O],V)}))};z(v)}catch(v){console.error(`解析配置ID ${l.id} 的JSON时出错:`,v)}const o=p.join(`
`);await navigator.clipboard.writeText(o),d.success(`已复制 ${p.length} 条路径到剪贴板`)}catch(r){console.error("批量复制路径失败:",r),d.error("批量复制路径失败")}},N=r=>{le({title:"确认删除",content:"确定要删除这个菜单配置吗？",okText:"删除",okType:"danger",cancelText:"取消",onOk:async()=>{try{await j.delete(r),d.success("删除成功"),u()}catch{d.error("删除失败")}}})},k=[{title:"菜单路径",dataIndex:"path",key:"path",width:250},{title:"迭代版本号",dataIndex:"version",key:"version",width:150},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",width:180,render:r=>new Date(r).toLocaleString()},{title:"更新时间",dataIndex:"updatedAt",key:"updatedAt",width:180,render:r=>new Date(r).toLocaleString()},{title:"操作",key:"action",width:240,render:(r,p)=>e.jsxs(F,{size:"small",children:[e.jsx(g,{size:"small",icon:e.jsx($,{}),onClick:()=>B(p.jsonConfig),children:"复制JSON"}),e.jsx(g,{size:"small",icon:e.jsx(Y,{}),onClick:()=>w(`/edit/${p.id}`),children:"编辑"}),e.jsx(g,{size:"small",danger:!0,icon:e.jsx(oe,{}),onClick:()=>N(p.id.toString()),children:"删除"})]})}];return e.jsxs("div",{style:{padding:"24px",background:"#f5f5f5",minHeight:"100vh"},children:[e.jsxs(A,{style:{marginBottom:"24px",boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[e.jsx(ce,{level:2,style:{margin:0,color:"#1890ff"},children:"📋 菜单配置管理系统"}),e.jsx(g,{type:"primary",size:"large",icon:e.jsx(ne,{}),onClick:()=>w("/add"),style:{borderRadius:"8px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none",boxShadow:"0 4px 12px rgba(102, 126, 234, 0.4)"},children:"新增菜单"})]}),e.jsxs("div",{style:{marginBottom:"20px",display:"flex",gap:"16px"},children:[e.jsx(R,{placeholder:"🔍 请选择迭代版本号筛选",allowClear:!0,size:"large",value:m,onChange:h,style:{width:400},children:ue().map(r=>e.jsx(de,{value:r.value,children:r.label},r.value))}),e.jsx(g,{type:"primary",size:"large",icon:e.jsx($,{}),onClick:L,disabled:!m,style:{borderRadius:"8px"},children:"批量复制路径"})]})]}),e.jsx(A,{style:{boxShadow:"0 2px 8px rgba(0,0,0,0.1)"},children:e.jsx(_,{columns:k,dataSource:s,rowKey:"id",loading:a,pagination:{total:s.length,pageSize:10,showSizeChanger:!0,showQuickJumper:!0,showTotal:r=>`共 ${r} 条记录`,style:{marginTop:"16px"}},style:{borderRadius:"8px"}})})]})},{Title:me}=T,{Option:he}=R,fe=()=>{const t=[];for(let s=1;s<=12;s++)for(let n=1;n<=2;n++){const a=`${s}月${n}期`,c=`2025年${s}月${n}期`;t.push({value:`2025-${a}`,label:c})}return t.sort((s,n)=>s.value.localeCompare(n.value))},E=()=>{const[t]=I.useForm(),[i,s]=f.useState(!1),[n,a]=f.useState(""),[c,m]=f.useState(""),[C,w]=f.useState(""),x=D(),{id:u}=P(),h=!!u;f.useEffect(()=>{h&&u?L(u):B()},[u,h]);const B=async()=>{try{const o=await j.getAll();if(o.length>0){const l=o[0];w(l.version),t.setFieldsValue({version:l.version})}}catch(o){console.error("获取最新配置失败:",o)}},L=async o=>{s(!0);try{const l=await j.getById(o);l?(t.setFieldsValue({version:l.version,path:l.path}),a(l.jsonConfig)):(d.error("菜单配置不存在"),x("/"))}catch{d.error("加载菜单配置失败"),x("/")}finally{s(!1)}},N=o=>{try{return JSON.parse(o),m(""),!0}catch{return m("JSON格式不正确"),!1}},k=o=>{const l=o||"";a(l),l.trim()?N(l):m("")},r=async o=>{if(!n.trim()){d.error("请输入菜单JSON配置");return}let l=n;if(l=n.replace(/hwsj/g,"touch"),!N(l)){d.error("JSON格式不正确，请检查后重试");return}s(!0);try{h&&u?(await j.update(u,{...o,jsonConfig:l}),d.success("更新成功")):(await j.add({...o,jsonConfig:l}),d.success("保存成功")),x("/")}catch{d.error(h?"更新失败":"保存失败")}finally{s(!1)}},p=()=>{try{const o=JSON.parse(n),l=JSON.stringify(o,null,2);a(l),m(""),d.success("JSON格式化成功")}catch{d.error("JSON格式不正确，无法格式化")}};return e.jsx("div",{style:{padding:"24px",background:"#f5f5f5",minHeight:"100vh"},children:e.jsxs("div",{style:{maxWidth:"1200px",margin:"0 auto"},children:[e.jsxs("div",{style:{marginBottom:"24px",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(g,{icon:e.jsx(W,{}),onClick:()=>x("/"),style:{marginRight:"16px",borderRadius:"8px",border:"1px solid #d9d9d9"},children:"返回列表"}),e.jsx(me,{level:2,style:{margin:0,color:"#1890ff"},children:h?"✏️ 编辑菜单配置":"➕ 新增菜单配置"})]}),e.jsx(g,{type:"primary",onClick:t.submit,loading:i,icon:e.jsx(ie,{}),size:"large",disabled:!!c||!n.trim(),style:{borderRadius:"8px",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",border:"none",boxShadow:"0 4px 12px rgba(102, 126, 234, 0.4)",height:"48px",fontSize:"16px"},children:h?"更新配置":"保存配置"})]}),e.jsx(A,{style:{boxShadow:"0 2px 8px rgba(0,0,0,0.1)",borderRadius:"12px"},children:e.jsxs(I,{form:t,layout:"vertical",onFinish:r,initialValues:{version:C,path:""},children:[e.jsx(I.Item,{label:"迭代版本号",name:"version",rules:[{required:!0,message:"请选择迭代版本号"}],children:e.jsx(R,{placeholder:"请选择迭代版本号",size:"large",showSearch:!0,filterOption:(o,l)=>{var v;return((v=l==null?void 0:l.children)==null?void 0:v.toString().toLowerCase().includes(o.toLowerCase()))||!1},style:{borderRadius:"8px"},children:fe().map(o=>e.jsx(he,{value:o.value,children:o.label},o.value))})}),e.jsx(I.Item,{label:"菜单路径",name:"path",rules:[{required:!0,message:"请输入菜单路径"}],children:e.jsx(X,{size:"large",style:{borderRadius:"8px"}})}),e.jsxs(I.Item,{label:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"菜单JSON配置"}),e.jsx(g,{size:"small",onClick:p,disabled:!n.trim(),style:{borderRadius:"6px"},children:"格式化JSON"})]}),required:!0,children:[e.jsx("div",{style:{border:"1px solid #d9d9d9",borderRadius:"8px",overflow:"hidden"},children:e.jsx(q,{height:"400px",defaultLanguage:"json",value:n,onChange:k,options:{minimap:{enabled:!1},scrollBeyondLastLine:!1,fontSize:14,wordWrap:"on",automaticLayout:!0},theme:"light"})}),c&&e.jsxs("div",{style:{color:"#ff4d4f",marginTop:"8px",fontSize:"14px"},children:["❌ ",c]}),!n.trim()&&e.jsx("div",{style:{color:"#ff4d4f",marginTop:"8px",fontSize:"14px"},children:"❌ 请输入菜单JSON配置"})]})]})})]})})},{Title:xe}=T,ge=()=>{const[t,i]=f.useState(null),[s,n]=f.useState(!1),a=D(),{id:c}=P();f.useEffect(()=>{c&&m(c)},[c]);const m=async x=>{n(!0);try{const u=await j.getById(x);u?i(u):(d.error("菜单配置不存在"),a("/"))}catch{d.error("加载菜单配置失败"),a("/")}finally{n(!1)}},C=async()=>{if(t)try{await navigator.clipboard.writeText(t.jsonConfig),d.success("JSON配置已复制到剪贴板")}catch{const u=document.createElement("textarea");u.value=t.jsonConfig,document.body.appendChild(u),u.select(),document.execCommand("copy"),document.body.removeChild(u),d.success("JSON配置已复制到剪贴板")}},w=async()=>{if(!t)return;const x={version:t.version,path:t.path,jsonConfig:JSON.parse(t.jsonConfig),createdAt:t.createdAt,updatedAt:t.updatedAt};try{await navigator.clipboard.writeText(JSON.stringify(x,null,2)),d.success("完整配置已复制到剪贴板")}catch{const h=document.createElement("textarea");h.value=JSON.stringify(x,null,2),document.body.appendChild(h),h.select(),document.execCommand("copy"),document.body.removeChild(h),d.success("完整配置已复制到剪贴板")}};return s?e.jsx("div",{style:{padding:"24px",textAlign:"center"},children:"加载中..."}):t?e.jsxs("div",{style:{padding:"24px",maxWidth:"1200px",margin:"0 auto"},children:[e.jsxs("div",{style:{marginBottom:"24px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[e.jsx(g,{icon:e.jsx(W,{}),onClick:()=>a("/"),style:{marginRight:"16px"},children:"返回列表"}),e.jsx(xe,{level:2,style:{margin:0},children:"菜单配置详情"})]}),e.jsxs(F,{children:[e.jsx(g,{icon:e.jsx($,{}),onClick:w,children:"复制全部"}),e.jsx(g,{type:"primary",icon:e.jsx(Y,{}),onClick:()=>a(`/edit/${c}`),children:"编辑配置"})]})]}),e.jsx(A,{style:{marginBottom:"24px"},children:e.jsxs(S,{title:"基本信息",bordered:!0,column:2,children:[e.jsx(S.Item,{label:"菜单路径",span:2,children:t.path}),e.jsx(S.Item,{label:"迭代版本号",children:t.version}),e.jsx(S.Item,{label:"配置ID",children:t.id}),e.jsx(S.Item,{label:"创建时间",children:new Date(t.createdAt).toLocaleString()}),e.jsx(S.Item,{label:"更新时间",children:new Date(t.updatedAt).toLocaleString()})]})}),e.jsx(A,{title:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("span",{children:"JSON配置"}),e.jsx(g,{size:"small",icon:e.jsx($,{}),onClick:C,children:"复制JSON"})]}),children:e.jsx("div",{style:{border:"1px solid #d9d9d9",borderRadius:"6px"},children:e.jsx(q,{height:"500px",defaultLanguage:"json",value:t.jsonConfig,options:{readOnly:!0,minimap:{enabled:!1},scrollBeyondLastLine:!1,fontSize:14,wordWrap:"on",automaticLayout:!0},theme:"light"})})})]}):e.jsx("div",{style:{padding:"24px",textAlign:"center"},children:"菜单配置不存在"})},ye=()=>e.jsx(Z,{locale:ee,children:e.jsx(re,{basename:"/menu-home",children:e.jsx("div",{className:"app",children:e.jsxs(se,{children:[e.jsx(J,{path:"/",element:e.jsx(pe,{})}),e.jsx(J,{path:"/add",element:e.jsx(E,{})}),e.jsx(J,{path:"/edit/:id",element:e.jsx(E,{})}),e.jsx(J,{path:"/detail/:id",element:e.jsx(ge,{})})]})})})});U.createRoot(document.getElementById("root")).render(e.jsx(Q.StrictMode,{children:e.jsx(ye,{})}));
